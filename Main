#include <string.h>

/* SerialUSB_Echo
 
 
 Demonstrates sending data from the computer to the CM900, OpenCM9.04
 echoes it to the computer again.
 You can just type in terminal program, character you typed will be displayed
 
 
 Compatibility
 CM900                  O
 OpenCM9.04             O
 
 
 created 16 Nov 2012
 by ROBOTIS CO,.LTD.
 */
int led = 9;
byte forward[] = {0xFF, 0x00, 0x01, 0x00, 0xFE};
byte capturedByte[] = {00, 00, 00, 00, 00};// Initialized to zero
int i = 0;
int j = 0;
int k = 0;
int m = 0;

void setup(){

  pinMode(led, OUTPUT);

  //You can attach your serialUSB interrupt
  //or, also detach the interrupt by detachInterrupt(void) method
  SerialUSB.attachInterrupt(usbInterrupt);

}

//USB max packet data is maximum 64byte, so nCount can not exceeds 64 bytes

void usbInterrupt(byte* buffer, byte nCount){
  //SerialUSB.print("nCount =");
  //SerialUSB.println(nCount);
  
  for( int i = 0; i < nCount; i++ )  //printf_SerialUSB_Buffer[N]_receive_Data
  {
    //SerialUSB.print((char)buffer[i]);

    //Loads buffer into capturedByte
    capturedByte[i] = buffer[i];
  }
    SerialUSB.print("nCount is: ");
    SerialUSB.println(nCount);
    
    SerialUSB.print("Captured Byte is: ");
    
    for (j = 0; j < sizeof(capturedByte); j++)
    {
      SerialUSB.print(capturedByte[j], HEX);
    }
    SerialUSB.println("");
    
    
    //Compare capturedByte to forward one byte at a time
    for( k = 0; k < sizeof(capturedByte); k++ )
    {
      if ( capturedByte[k] == forward[k] )
      {
        m = m + 1;
      }
      else
      {}
    }// Close k for loop

  SerialUSB.print("m equals: ");
  SerialUSB.println(m);
  if (m == 5)
  {
    SerialUSB.print("You go forward");
  }
  else{}
}

void loop(){
  delay(1000);
}

void blink()
{
  digitalWrite(led, HIGH);
  delay(500);
  digitalWrite(led, LOW);
  delay(500);
}

